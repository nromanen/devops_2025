Де_факто тут "чистовик" роботи, щоб не плодити  ці тисячі рякдів неправильного синтаксису.


ivan@osboxes:~$ #start task Postgres

ivan@osboxes:~$ sudo apt update
Hit:1 http://us.archive.ubuntu.com/ubuntu jammy InRelease
Hit:2 http://us.archive.ubuntu.com/ubuntu jammy-updates InRelease
Hit:3 http://us.archive.ubuntu.com/ubuntu jammy-backports InRelease
Hit:4 http://us.archive.ubuntu.com/ubuntu jammy-security InRelease
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
17 packages can be upgraded. Run 'apt list --upgradable' to see them.
ivan@osboxes:~$ sudo apt install postgresql postgresql-contrib -y
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
The following additional packages will be installed:
  libcommon-sense-perl libjson-perl libjson-xs-perl libllvm14 libpq5 libsensors-config libsensors5
  libtypes-serialiser-perl postgresql-14 postgresql-client-14 postgresql-client-common postgresql-common sysstat
Suggested packages:
  lm-sensors postgresql-doc postgresql-doc-14 isag
The following NEW packages will be installed:
  libcommon-sense-perl libjson-perl libjson-xs-perl libllvm14 libpq5 libsensors-config libsensors5
  libtypes-serialiser-perl postgresql postgresql-14 postgresql-client-14 postgresql-client-common postgresql-common
  postgresql-contrib sysstat
0 upgraded, 15 newly installed, 0 to remove and 17 not upgraded.
Need to get 42.5 MB of archives.
After this operation, 162 MB of additional disk space will be used.
Get:1 http://us.archive.ubuntu.com/ubuntu jammy/main amd64 libcommon-sense-perl amd64 3.75-2build1 [21.1 kB]
Get:2 http://us.archive.ubuntu.com/ubuntu jammy/main amd64 libjson-perl all 4.04000-1 [81.8 kB]
Get:3 http://us.archive.ubuntu.com/ubuntu jammy/main amd64 libtypes-serialiser-perl all 1.01-1 [11.6 kB]
Get:4 http://us.archive.ubuntu.com/ubuntu jammy/main amd64 libjson-xs-perl amd64 4.030-1build3 [87.2 kB]
Get:5 http://us.archive.ubuntu.com/ubuntu jammy-updates/main amd64 libllvm14 amd64 1:14.0.0-1ubuntu1.1 [24.0 MB]
Get:6 http://us.archive.ubuntu.com/ubuntu jammy-updates/main amd64 libpq5 amd64 14.17-0ubuntu0.22.04.1 [152 kB]
Get:7 http://us.archive.ubuntu.com/ubuntu jammy/main amd64 libsensors-config all 1:3.6.0-7ubuntu1 [5,274 B]
Get:8 http://us.archive.ubuntu.com/ubuntu jammy/main amd64 libsensors5 amd64 1:3.6.0-7ubuntu1 [26.3 kB]
Get:9 http://us.archive.ubuntu.com/ubuntu jammy/main amd64 postgresql-client-common all 238 [29.6 kB]
Get:10 http://us.archive.ubuntu.com/ubuntu jammy-updates/main amd64 postgresql-client-14 amd64 14.17-0ubuntu0.22.04.1 [1,246 kB]
Get:11 http://us.archive.ubuntu.com/ubuntu jammy/main amd64 postgresql-common all 238 [169 kB]
Get:12 http://us.archive.ubuntu.com/ubuntu jammy-updates/main amd64 postgresql-14 amd64 14.17-0ubuntu0.22.04.1 [16.2 MB]
Get:13 http://us.archive.ubuntu.com/ubuntu jammy/main amd64 postgresql all 14+238 [3,288 B]
Get:14 http://us.archive.ubuntu.com/ubuntu jammy/main amd64 postgresql-contrib all 14+238 [3,292 B]
Get:15 http://us.archive.ubuntu.com/ubuntu jammy-updates/main amd64 sysstat amd64 12.5.2-2ubuntu0.2 [487 kB]
Fetched 42.5 MB in 6s (7,292 kB/s)
Preconfiguring packages ...
Selecting previously unselected package libcommon-sense-perl:amd64.
(Reading database ... 117639 files and directories currently installed.)
Preparing to unpack .../00-libcommon-sense-perl_3.75-2build1_amd64.deb ...
Unpacking libcommon-sense-perl:amd64 (3.75-2build1) ...
Selecting previously unselected package libjson-perl.
Preparing to unpack .../01-libjson-perl_4.04000-1_all.deb ...
Unpacking libjson-perl (4.04000-1) ...
Selecting previously unselected package libtypes-serialiser-perl.
Preparing to unpack .../02-libtypes-serialiser-perl_1.01-1_all.deb ...
Unpacking libtypes-serialiser-perl (1.01-1) ...
Selecting previously unselected package libjson-xs-perl.
Preparing to unpack .../03-libjson-xs-perl_4.030-1build3_amd64.deb ...
Unpacking libjson-xs-perl (4.030-1build3) ...
Selecting previously unselected package libllvm14:amd64.
Preparing to unpack .../04-libllvm14_1%3a14.0.0-1ubuntu1.1_amd64.deb ...
Unpacking libllvm14:amd64 (1:14.0.0-1ubuntu1.1) ...
Selecting previously unselected package libpq5:amd64.
Preparing to unpack .../05-libpq5_14.17-0ubuntu0.22.04.1_amd64.deb ...
Unpacking libpq5:amd64 (14.17-0ubuntu0.22.04.1) ...
Selecting previously unselected package libsensors-config.
Preparing to unpack .../06-libsensors-config_1%3a3.6.0-7ubuntu1_all.deb ...
Unpacking libsensors-config (1:3.6.0-7ubuntu1) ...
Selecting previously unselected package libsensors5:amd64.
Preparing to unpack .../07-libsensors5_1%3a3.6.0-7ubuntu1_amd64.deb ...
Unpacking libsensors5:amd64 (1:3.6.0-7ubuntu1) ...
Selecting previously unselected package postgresql-client-common.
Preparing to unpack .../08-postgresql-client-common_238_all.deb ...
Unpacking postgresql-client-common (238) ...
Selecting previously unselected package postgresql-client-14.
Preparing to unpack .../09-postgresql-client-14_14.17-0ubuntu0.22.04.1_amd64.deb ...
Unpacking postgresql-client-14 (14.17-0ubuntu0.22.04.1) ...
Selecting previously unselected package postgresql-common.
Preparing to unpack .../10-postgresql-common_238_all.deb ...
Adding 'diversion of /usr/bin/pg_config to /usr/bin/pg_config.libpq-dev by postgresql-common'
Unpacking postgresql-common (238) ...
Selecting previously unselected package postgresql-14.
Preparing to unpack .../11-postgresql-14_14.17-0ubuntu0.22.04.1_amd64.deb ...
Unpacking postgresql-14 (14.17-0ubuntu0.22.04.1) ...
Selecting previously unselected package postgresql.
Preparing to unpack .../12-postgresql_14+238_all.deb ...
Unpacking postgresql (14+238) ...
Selecting previously unselected package postgresql-contrib.
Preparing to unpack .../13-postgresql-contrib_14+238_all.deb ...
Unpacking postgresql-contrib (14+238) ...
Selecting previously unselected package sysstat.
Preparing to unpack .../14-sysstat_12.5.2-2ubuntu0.2_amd64.deb ...
Unpacking sysstat (12.5.2-2ubuntu0.2) ...
Setting up postgresql-client-common (238) ...
Setting up libsensors-config (1:3.6.0-7ubuntu1) ...
Setting up libpq5:amd64 (14.17-0ubuntu0.22.04.1) ...
Setting up libcommon-sense-perl:amd64 (3.75-2build1) ...
Setting up postgresql-client-14 (14.17-0ubuntu0.22.04.1) ...
update-alternatives: using /usr/share/postgresql/14/man/man1/psql.1.gz to provide /usr/share/man/man1/psql.1.gz (psql.1.gz) in auto mode
Setting up libsensors5:amd64 (1:3.6.0-7ubuntu1) ...
Setting up libllvm14:amd64 (1:14.0.0-1ubuntu1.1) ...
Setting up libtypes-serialiser-perl (1.01-1) ...
Setting up libjson-perl (4.04000-1) ...
Setting up sysstat (12.5.2-2ubuntu0.2) ...
update-alternatives: using /usr/bin/sar.sysstat to provide /usr/bin/sar (sar) in auto mode
Setting up libjson-xs-perl (4.030-1build3) ...
Setting up postgresql-common (238) ...

Creating config file /etc/postgresql-common/createcluster.conf with new version
Building PostgreSQL dictionaries from installed myspell/hunspell packages...
Removing obsolete dictionary files:
Created symlink /etc/systemd/system/multi-user.target.wants/postgresql.service → /lib/systemd/system/postgresql.service.
Setting up postgresql-14 (14.17-0ubuntu0.22.04.1) ...
Creating new PostgreSQL cluster 14/main ...
/usr/lib/postgresql/14/bin/initdb -D /var/lib/postgresql/14/main --auth-local peer --auth-host scram-sha-256 --no-instructions
The files belonging to this database system will be owned by user "postgres".
This user must also own the server process.

The database cluster will be initialized with locale "en_US.UTF-8".
The default database encoding has accordingly been set to "UTF8".
The default text search configuration will be set to "english".

Data page checksums are disabled.

fixing permissions on existing directory /var/lib/postgresql/14/main ... ok
creating subdirectories ... ok
selecting dynamic shared memory implementation ... posix
selecting default max_connections ... 100
selecting default shared_buffers ... 128MB
selecting default time zone ... Etc/UTC
creating configuration files ... ok
running bootstrap script ... ok
performing post-bootstrap initialization ... ok
syncing data to disk ... ok
update-alternatives: using /usr/share/postgresql/14/man/man1/postmaster.1.gz to provide /usr/share/man/man1/postmaster.1.gz (postmaster.1.gz) in auto mode
Setting up postgresql-contrib (14+238) ...
Setting up postgresql (14+238) ...
Processing triggers for man-db (2.10.2-1) ...
Processing triggers for libc-bin (2.35-0ubuntu3.9) ...
Scanning processes...
Scanning linux images...

Running kernel seems to be up-to-date.

No services need to be restarted.

No containers need to be restarted.

No user sessions are running outdated binaries.

No VM guests are running outdated hypervisor (qemu) binaries on this host.
ivan@osboxes:~$ psql --version
psql (PostgreSQL) 14.17 (Ubuntu 14.17-0ubuntu0.22.04.1)
ivan@osboxes:~$ sudo -i -u postgres
postgres@osboxes:~$ psql
psql (14.17 (Ubuntu 14.17-0ubuntu0.22.04.1))
Type "help" for help.

postgres=# CREATE DATABASE postnatalya;
CREATE DATABASE
postgres=# CREATE USER ivan WITH PASSWORD '1234';
CREATE ROLE
postgres=# GRANT ALL PRIVILEGES ON DATABASE postnatalya TO ivan;
GRANT
postgres=# \l
                                   List of databases
    Name     |  Owner   | Encoding |   Collate   |    Ctype    |   Access privileges
-------------+----------+----------+-------------+-------------+-----------------------
 postgres    | postgres | UTF8     | en_US.UTF-8 | en_US.UTF-8 |
 postnatalya | postgres | UTF8     | en_US.UTF-8 | en_US.UTF-8 | =Tc/postgres         +
             |          |          |             |             | postgres=CTc/postgres+
             |          |          |             |             | ivan=CTc/postgres
 template0   | postgres | UTF8     | en_US.UTF-8 | en_US.UTF-8 | =c/postgres          +
             |          |          |             |             | postgres=CTc/postgres
 template1   | postgres | UTF8     | en_US.UTF-8 | en_US.UTF-8 | =c/postgres          +
             |          |          |             |             | postgres=CTc/postgres
(4 rows)

postgres=# \q
postgres@osboxes:~$ su - ivan
Password:
ivan@osboxes:~$ psql -U ivan -d PostN -h localhost
Password for user ivan:
psql: error: connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  database "PostN" does not exist
ivan@osboxes:~$ psql -U ivan -d postnatalya -h localhost
Password for user ivan:
psql (14.17 (Ubuntu 14.17-0ubuntu0.22.04.1))
SSL connection (protocol: TLSv1.3, cipher: TLS_AES_256_GCM_SHA384, bits: 256, compression: off)
Type "help" for help.

postnatalya=> CREATE TABLE Users (user_id SERIAL PRIMARY KEY, user_name VARCHAR(100) NOT NULL);
CREATE TABLE
postnatalya=> CREATE TABLE Products (product_id SERIAL PRIMARY KEY,product_name VARCHAR(100) NOT NULL, product_category VARCHAR(50) NOT NULL);
CREATE TABLE
postnatalya=> \dt
         List of relations
 Schema |   Name   | Type  | Owner
--------+----------+-------+-------
 public | products | table | ivan
 public | users    | table | ivan
(2 rows)

postnatalya=> INSERT INTO Users (user_name) VALUES
('Artem Shkondeiuk'),
('Baklykov Oleksandr'),
('Horbatiuk Vitalii'),
('Horbatiuk Ivan'),
('Hushuley Yaryna'),
('Igor Polatayko'),
('Iryna Chernobel'),
('Ivan Zhaldak'),
('Kateryna Kravchuk'),
('Kulnieva Mariia'),
('Maksym Maksymenko');
INSERT 0 11
postnatalya=> INSERT INTO Products (product_name, product_category) VALUES
('Пшениця', 'Зернові'),
('Кукурудза', 'Зернові'),
('Яблука', 'Фрукти'),
('Морква', 'Овочі'),
('Картопля', 'Овочі'),
('Огірки', 'Овочі'),
('Томати', 'Овочі'),
('Вишня', 'Фрукти'),
('Груші', 'Фрукти'),
('Гречка', 'Зернові');
INSERT 0 10
postnatalya=> SELECT * FROM Users;
 user_id |     user_name
---------+--------------------
       1 | Artem Shkondeiuk
       2 | Baklykov Oleksandr
       3 | Horbatiuk Vitalii
       4 | Horbatiuk Ivan
       5 | Hushuley Yaryna
       6 | Igor Polatayko
       7 | Iryna Chernobel
       8 | Ivan Zhaldak
       9 | Kateryna Kravchuk
      10 | Kulnieva Mariia
      11 | Maksym Maksymenko
(11 rows)

postnatalya=> SELECT * FROM Products;
 product_id | product_name | product_category
------------+--------------+------------------
          1 | Пшениця      | Зернові
          2 | Кукурудза    | Зернові
          3 | Яблука       | Фрукти
          4 | Морква       | Овочі
          5 | Картопля     | Овочі
          6 | Огірки       | Овочі
          7 | Томати       | Овочі
          8 | Вишня        | Фрукти
          9 | Груші        | Фрукти
         10 | Гречка       | Зернові
(10 rows)

postnatalya=> \q
ivan@osboxes:~$ pg_dump -U ivan -d postnatalya -F c -f postnatalya_backup.sql
ivan@osboxes:~$ ls -lh postnatalya_backup.sql
-rw-rw-r-- 1 ivan ivan 5.2K Mar 15 15:42 postnatalya_backup.sql
ivan@osboxes:~$ psql -U ivan -d postnatalya -h localhost
Password for user ivan:
psql (14.17 (Ubuntu 14.17-0ubuntu0.22.04.1))
SSL connection (protocol: TLSv1.3, cipher: TLS_AES_256_GCM_SHA384, bits: 256, compression: off)
Type "help" for help.

postnatalya=> CREATE DATABASE postnatalya_restore;
ERROR:  permission denied to create database
postnatalya=> \q
ivan@osboxes:~$ psql -U postgress -d postnatalya -h localhost
Password for user postgress:
psql: error: connection to server at "localhost" (127.0.0.1), port 5432 failed: fe_sendauth: no password supplied
ivan@osboxes:~$ psql -U postgres -d postnatalya -h localhost
Password for user postgres:
psql: error: connection to server at "localhost" (127.0.0.1), port 5432 failed: fe_sendauth: no password supplied
ivan@osboxes:~$ sudo -i -u postgres
psql
[sudo] password for ivan:
postgres@osboxes:~$ ALTER USER postgres WITH PASSWORD '1234';
ALTER: command not found
postgres@osboxes:~$ sudo ALTER USER postgres WITH PASSWORD '1234';
[sudo] password for postgres:
Sorry, try again.
[sudo] password for postgres:
Sorry, try again.
[sudo] password for postgres:
sudo: 2 incorrect password attempts
postgres@osboxes:~$ sudo -i -u postgres
psql
postgres is not in the sudoers file.  This incident will be reported.
psql (14.17 (Ubuntu 14.17-0ubuntu0.22.04.1))
Type "help" for help.

postgres=# ALTER USER postgres WITH PASSWORD '1234';
ALTER ROLE
postgres=# \q
postgres@osboxes:~$ sudo -i -u postgres
psql
postgres is not in the sudoers file.  This incident will be reported.
psql (14.17 (Ubuntu 14.17-0ubuntu0.22.04.1))
Type "help" for help.

postgres=# ALTER USER ivan CREATEDB;
ALTER ROLE
postgres=# \q
postgres@osboxes:~$ psql -U postgres -d postnatalya -h localhost -W
Password:
psql (14.17 (Ubuntu 14.17-0ubuntu0.22.04.1))
SSL connection (protocol: TLSv1.3, cipher: TLS_AES_256_GCM_SHA384, bits: 256, compression: off)
Type "help" for help.

postnatalya=# su - ivan
psql -U ivan -d postnatalya -h localhost
postnatalya-# CREATE DATABASE postnatalya_restore;
ERROR:  syntax error at or near "su"
LINE 1: su - ivan
        ^
postnatalya=# \q
postgres@osboxes:~$ su - ivan
Password:
ivan@osboxes:~$ psql -U ivan -d postnatalya -h localhost
Password for user ivan:
psql (14.17 (Ubuntu 14.17-0ubuntu0.22.04.1))
SSL connection (protocol: TLSv1.3, cipher: TLS_AES_256_GCM_SHA384, bits: 256, compression: off)
Type "help" for help.

postnatalya=> CREATE DATABASE postnatalya_restore;
CREATE DATABASE
postnatalya=> \q
ivan@osboxes:~$ pg_restore -U ivan -d postnatalya_restore postnatalya_backup.sql
ivan@osboxes:~$ psql -U ivan -d postnatalya_restore -h localhost
Password for user ivan:
psql (14.17 (Ubuntu 14.17-0ubuntu0.22.04.1))
SSL connection (protocol: TLSv1.3, cipher: TLS_AES_256_GCM_SHA384, bits: 256, compression: off)
Type "help" for help.

postnatalya_restore=> \dt
         List of relations
 Schema |   Name   | Type  | Owner
--------+----------+-------+-------
 public | products | table | ivan
 public | users    | table | ivan
(2 rows)

postnatalya_restore=> SELECT * FROM Users;
SELECT * FROM Products;
 user_id |     user_name
---------+--------------------
       1 | Artem Shkondeiuk
       2 | Baklykov Oleksandr
       3 | Horbatiuk Vitalii
       4 | Horbatiuk Ivan
       5 | Hushuley Yaryna
       6 | Igor Polatayko
       7 | Iryna Chernobel
       8 | Ivan Zhaldak
       9 | Kateryna Kravchuk
      10 | Kulnieva Mariia
      11 | Maksym Maksymenko
(11 rows)

 product_id | product_name | product_category
------------+--------------+------------------
          1 | Пшениця      | Зернові
          2 | Кукурудза    | Зернові
          3 | Яблука       | Фрукти
          4 | Морква       | Овочі
          5 | Картопля     | Овочі
          6 | Огірки       | Овочі
          7 | Томати       | Овочі
          8 | Вишня        | Фрукти
          9 | Груші        | Фрукти
         10 | Гречка       | Зернові
(10 rows)

postnatalya_restore=> \q
ivan@osboxes:~$ mv postnatalya_backup.sql /nmt/ivshared/
mv: cannot move 'postnatalya_backup.sql' to '/nmt/ivshared/': No such file or directory
ivan@osboxes:~$ mv postnatalya_backup.sql /mnt/ivshared/
ivan@osboxes:~$ ls -lh /mnt/ivshared/
total 25K
-rwxrwxrwx 1 root root 5.2K Mar 15 15:42 postnatalya_backup.sql
drwxrwxrwx 1 root root    0 Feb 23 15:25 task
-rwxrwxrwx 1 root root   17 Feb 22 16:51 test_from_ubuntu.txt
-rwxrwxrwx 1 root root    0 Feb 22 16:51 test_from_windows.txt.txt
-rwxrwxrwx 1 root root  10K Feb 23 14:46 textprocessingtask.tar
-rwxrwxrwx 1 root root 1.9K Mar  7 23:31 tmpw23bqem5-ascii.cast
ivan@osboxes:~$  #URAAAA  THE END!!!!!
ivan@osboxes:~$